var page=$("html, body"),body=$("body"),isMobile=!1,isDev=!1,mobileUserAgentString=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i;mobileUserAgentString.test(navigator.userAgent)&&(isMobile=!0,$(document).on("touchmove",function(a){a.preventDefault()})),$(document).ready(function(){function autoPopulatePreload(){body.append('<div id="preload"></div>');var a=$("#preload");$("img").each(function(){var e=$(this).attr("src");a.append('<img src="'+e+'" alt="">')}),$("[data-background-image]").each(function(){var e=$(this).data("background-image");a.append('<img src="'+e+'" alt="">')}),$('[style*="background-image"]').each(function(){var e=$(this).attr("style").replace("background-image: url(","").replace(")","").replace(";","");a.append('<img src="'+e+'" alt="">')}),isMobile||($("[data-music]").each(function(){var e=$(this);a.append('<audio id="music-for-'+e.index("section")+'" loop preload="true"><source src="'+e.data("music")+'" type="audio/mpeg"></audio>')}),$("[data-sound]").each(function(){var e=$(this);a.append('<audio id="sound-for-'+e.index("section")+'" preload="true"><source src="'+e.data("sound")+'" type="audio/mpeg"></audio>')}))}function adjustVolume(a,e,t){$(a).stop().animate({volume:e},1e3,"linear",t)}function swapMusic(a){a[0].paused&&(music.each(function(){var a=$(this);adjustVolume(a,0,function(){a[0].pause()})}),a[0].volume=0,a[0].play(),adjustVolume(a,masterVolume))}function playChapterMusic(a){if(a.hasClass("end")){var e=a.prevAll(".has-intro").first().index("section"),t=$("#music-for-"+e);swapMusic(t)}else if(a.hasClass("has-intro")){var o=a.index("section"),n=$("#music-for-"+o);swapMusic(n)}else a.is("#home")&&swapMusic($("#music-for-0"))}function muteChapterMusic(a){var e=a.prevAll(".has-intro").first().index("section"),t=$("#music-for-"+e);adjustVolume(t[0],0),onePageScroll.one("before-move.np",function(){activeSection.hasClass("has-intro")||adjustVolume(t[0],masterVolume)})}function playSound(a){var e=a.index("section"),t=$("#sound-for-"+e),o=sound.not(t);adjustVolume(sound,0,function(){o[0].pause(),o[0].currentTime=0}),t.length>0?(t[0].play(),adjustVolume(t,masterVolume)):sound.each(function(){var a=$(this);adjustVolume(a[0],0,function(){a[0].pause(),a[0].currentTime=0})})}function calculateFullParentHeight(){var a=window.innerHeight;fullParentHeight.css("height",a+"px")}function substituteVideoElements(a){var e=a.attr("id"),t=a.attr("style");a.replaceWith('<div id="'+e+'"class="video-substitute" style="'+t+'"></div>')}function setCenter(){videoBackground.each(function(){var a=page.width(),e=page.height(),t=$(this).width(),o=$(this).height(),n=a/2-t/2+"px",i=e/2-o/2+"px";$(this).css({left:n,top:i})})}function playVideo(){videoBackground.each(function(){$(this)[0].play()})}function beginLoading(){function a(){if(!body.hasClass("loaded")){i++;var a=parseInt(i/o*100);n.css("width",a+"%"),r.text(a),i>=o&&body.trigger("load.np")}}var e=$("#preload img"),t=$("#preload audio, .video-background[data-src][data-formats]"),o=isMobile?e.length:e.length+t.length,n=$("#loading-bar"),i=0,r=$("#loading-percentage .number");e.each(function(){$(this).load(a)}),t.each(function(){var e=$(this)[0];e.readyState>3?a():e.oncanplay=a}),page.one("load.np",function(){var a=$("#home-video"),e=$("#music-for-0"),t=$("#home .scroll-message");setTimeout(function(){body.addClass("loaded"),a.addClass("show"),isMobile||e[0].play()},250),setTimeout(function(){body.trigger("start.np")},isDev?0:1e3),setTimeout(function(){t.addClass("show")},2500)}),isDev&&setTimeout(function(){body.trigger("load.np")},500)}function resizeQuoteBackgroundImages(){var a=$(window).width();quoteBackgroundImage.each(function(){var e=$(this),t=e.closest(".container").width(),o=a-t;e.css({left:"-"+o/2+"px",right:"-"+o/2+"px"})})}function calculateNavEntryHeight(){var a=window.innerWidth,e=window.innerHeight,t=matchMedia("only screen and (max-width: 480px)").matches?e-a/linkCount-5:e,o=t/linkCount;navEntry.css("height",o+"px")}function openNav(){body.addClass("nav-open").addClass("disable-scroll"),navEntry.each(function(){var a=this,e=$(a).index();setTimeout(function(){$(a).addClass("show")},75*(e+1))}),setTimeout(function(){blurElements.addClass("blur")},250)}function closeNav(){body.removeClass("nav-open").removeClass("disable-scroll"),navEntry.removeClass("show"),setTimeout(function(){blurElements.removeClass("blur")},150)}function findIndex(a,e){for(var t,o=0;o<e.length;o++){var n=e.eq(o);if(a.is(n)){t=o;break}}return t}function setSubNavPosition(a){var e,t,o,n=$(a).hasClass("has-intro"),i=$('section[id*="chapter"]'),r=$("#home");if(subNavEntry.removeClass("active"),n)e=findIndex(a,i),t=$('[href="#'+i.eq(e).attr("id")+'"]',subNavEntry).parent(),o=e/i.length*100+"%";else if(a.is(r))o=0;else{e=findIndex(a,section);var l=section.eq(e).prevAll(".has-intro").first(),s=(l.attr("id"),findIndex(l,section)),c=findIndex(l,i),d=c/i.length*100,e=findIndex(a,section),u=(e-s)/chapterSectionArray[c]/i.length*100;t=$('[href="#'+section.eq(s).attr("id")+'"]',subNavEntry).parent(),o=d+u+"%"}positionIndicator.css({width:"",height:""}),matchMedia("only screen and (max-width: 480px)").matches?positionIndicator.css("width",o):positionIndicator.css("height",o),t&&t.addClass("active")}function processAnimateIn(a){var e=$(".animate-in",a),t=$(".scroll-message",a);e.each(function(){function a(){0==t||e.is("[data-delay]")||e.attr("data-delay",t+"00")}var e=$(this),t=e.index();$.when(a()).done(function(){var a=e.data("delay")||0;setTimeout(function(){e.addClass("reveal")},a)})}),t.addClass("show")}function enableParallax(a,e){switch(e){case"home-parallax":"undefined"==typeof homeParallaxObj?homeParallaxObj=a.parallax():homeParallaxObj.parallax("enable");break;case"chapter-1-parallax":"undefined"==typeof chapter1ParallaxObj?chapter1ParallaxObj=a.parallax():chapter1ParallaxObj.parallax("enable");break;case"chapter-2-parallax":"undefined"==typeof chapter2ParallaxObj?chapter2ParallaxObj=a.parallax():chapter2ParallaxObj.parallax("enable");break;case"chapter-3-parallax":"undefined"==typeof chapter3ParallaxObj?chapter3ParallaxObj=a.parallax():chapter3ParallaxObj.parallax("enable");break;case"chapter-4-parallax":"undefined"==typeof chapter4ParallaxObj?chapter4ParallaxObj=a.parallax():chapter4ParallaxObj.parallax("enable");break;case"chapter-5-parallax":"undefined"==typeof chapter5ParallaxObj?chapter5ParallaxObj=a.parallax():chapter5ParallaxObj.parallax("enable");break;case"chapter-6-parallax":"undefined"==typeof chapter6ParallaxObj?chapter6ParallaxObj=a.parallax():chapter6ParallaxObj.parallax("enable")}}function disableParallax(a){switch(a){case"home-parallax":"undefined"!=typeof homeParallaxObj&&homeParallaxObj.parallax("disable");break;case"chapter-1-parallax":"undefined"!=typeof chapter1ParallaxObj&&chapter1ParallaxObj.parallax("disable");break;case"chapter-2-parallax":"undefined"!=typeof chapter2ParallaxObj&&chapter2ParallaxObj.parallax("disable");break;case"chapter-3-parallax":"undefined"!=typeof chapter3ParallaxObj&&chapter3ParallaxObj.parallax("disable");break;case"chapter-4-parallax":"undefined"!=typeof chapter4ParallaxObj&&chapter4ParallaxObj.parallax("disable");break;case"chapter-5-parallax":"undefined"!=typeof chapter5ParallaxObj&&chapter5ParallaxObj.parallax("disable");break;case"chapter-6-parallax":"undefined"!=typeof chapter6ParallaxObj&&chapter6ParallaxObj.parallax("disable")}}function showHomeFireworks(){var a=$("> li",homeParallaxList);homeParallaxList.addClass("show"),a.each(function(){var a=$("img",this),e=$(this).index();setTimeout(function(){a.addClass("show")},100*e)})}function processBeforeMove(){if(activeSection=$("section.active"),onePageScroll.trigger("before-move.np"),activeSection.is("#home")?(homeVideo.addClass("show"),horizontalLogo.removeClass("show"),subNav.removeClass("show"),fireworksList.addClass("show"),enableParallax(fireworksList,"fireworks")):(homeVideo.removeClass("show"),subNav.addClass("show"),horizontalLogo.addClass("show"),fireworksList.removeClass("show"),disableParallax("fireworks")),activeSection.hasClass("has-overlay")?overlay.addClass("show"):overlay.removeClass("show"),activeSection.hasClass("has-underlay")){var underlayUrl=activeSection.data("underlay-background");onlyFadeUnderlay?(underlay.addClass("only-fade"),onlyFadeUnderlay=!1):underlay.removeClass("only-fade"),underlay.css("background-image","url("+underlayUrl+")").addClass("show")}else underlay.removeClass("show");if(activeSection.hasClass("has-parallax")){var parallaxList=activeSection.data("parallax-list"),parallaxId=activeSection.data("parallax-id");parallaxList.addClass("show"),enableParallax(eval(parallaxList),parallaxId),console.log(eval(parallaxList))}if(activeSection.hasClass("has-background-underlay")){var backgroundImageUrl=activeSection.data("background-image");backgroundImage.css("background-image","url("+backgroundImageUrl+")").addClass("show")}else backgroundImage.removeClass("show");activeSection.is("#home")||activeSection.hasClass("has-overlay")||activeSection.hasClass("has-underlay")?backgroundVideo.removeClass("show"):backgroundVideo.addClass("show"),activeSection.hasClass("end")&&(onlyFadeUnderlay=!0),setSubNavPosition(activeSection),isMobile||(activeSection.hasClass("no-music")&&muteChapterMusic(activeSection),playChapterMusic(activeSection),playSound(activeSection))}function processAfterMove(){onePageScroll.trigger("after-move.np"),processAnimateIn(activeSection)}function calculateTimelineBorders(){setTimeout(function(){var a;if(matchMedia("only screen and (max-width: 480px)").matches){var e=$(window).width();a=e/linkCount-20}else a=20;timelineEntryStart.each(function(){var e=$(this).find(".timeline-content").offset().top,t=$(this).closest("section").offset().top,o=e-t+timelineMarkOffset+a,n=$(".timeline-border",this);n.css("top",o+"px")}),timelineEntryEnd.each(function(){var a=$(this).find(".timeline-body").last().height(),e=$(this).find(".timeline-content").innerHeight(),t=$(this).closest("section").height()>560?$(this).closest("section").height():560,o=$(this).find(".timeline-gallery").outerHeight(!0),n=$(this).find(".timeline-slider").outerHeight(!0),i=(t-e)/2+a+o+n-timelineMarkOffset,r=$(".timeline-border",this);r.css("bottom",i+"px")})},1e3)}function centerQuoteImages(){quoteImageContainer.each(function(){var a=$(this),e=$(".quote-image",a),t=a.width(),o=a.height(),n=e.width(),i=e.height(),r=t-n,l=o-i,s=e.data("offset-x")||0,c=e.data("offset-y")||0;e.css({left:r/2+s+"px",top:l/2+c+"px"})})}var onePageScroll=$("#main");$.when(autoPopulatePreload()).done(beginLoading);var audioIcon=$("#audio-icon"),audio=$("audio"),music=$('audio[id*="music-for"]'),sound=$('audio[id*="sound-for"]'),masterVolume=1;isMobile?audioIcon.unbind():audioIcon.click(function(){$(this).hasClass("fa-volume-up")?($(this).removeClass("fa-volume-up").addClass("fa-volume-off").addClass("adjust-p-r-6"),masterVolume=0):($(this).removeClass("fa-volume-off").addClass("fa-volume-up").removeClass("adjust-p-r-6"),masterVolume=1),audio.each(function(){var a=$(this);a.stop(!1,!0),a.is(sound)&&1===masterVolume?a[0].volume=0:(a.is(sound)&&0===masterVolume&&(a[0].pause(),a[0].currentTime=0),a[0].volume=masterVolume)})}).parent().addClass("show");var fullParentHeight=$(".full-parent-height");calculateFullParentHeight(),$(window).resize(calculateFullParentHeight);var videoBackground=$(".video-background"),scrollPos,adjustedPos,videoOffset;isMobile?videoBackground.each(function(){substituteVideoElements($(this))}):videoBackground.each(function(){var a=$(this),e=a.data("src"),t="undefined"!=typeof a.data("formats")?a.data("formats").replace(" ","").split(","):"";if(e&&t.length>0)for(var o=0;o<t.length;o++)a.append('<source src="'+e+"."+t[o]+'">');else substituteVideoElements(a)}),$(window).resize(setCenter),$(window).load(setCenter),!isMobile&&videoBackground.length>0&&$(window).load(playVideo);var quoteBackgroundImage=$(".quote-background-image");resizeQuoteBackgroundImages(),$(window).resize($.debounce(500,resizeQuoteBackgroundImages));var navEntry=$("nav > ul > li"),navLink=$("a",navEntry),linkCount=navEntry.length,openNavButton=$("#open-nav-button"),closeNavButton=$("#close-nav-button"),blurElements=$("#underlay, #clouds, #fireworks, .video-background, .video-substitute"),main=$(".main");navLink.click(function(a){a.preventDefault();var e=$(this).attr("href"),t=$(e).index()+1;closeNav(),main.moveTo(t)}),calculateNavEntryHeight(),$(window).resize($.debounce(750,calculateNavEntryHeight)),openNavButton.click(openNav),closeNavButton.click(closeNav);for(var subNavEntry=$("#sub-nav > ul > li"),subNavLink=$("a",subNavEntry),positionIndicator=$("#position-indicator"),section=$("section:not(#home)"),chapterSectionArray=[],sectionCount=1,i=0;i<section.length;i++){var currentSection=section.eq(i);currentSection.hasClass("end")?(chapterSectionArray.push(sectionCount),sectionCount=1):sectionCount++}subNavLink.click(function(a){a.preventDefault();var e=$(this).attr("href"),t=$(e).index()+1;main.moveTo(t)}),$(window).resize($.debounce(750,function(){setSubNavPosition($("section.active"))}));var homeLink=$(".logo-container.horizontal > a");homeLink.click(function(){main.moveTo(1)});var sectionElements=$("#main section *");sectionElements.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend webkitTransitionStart otransitionstart oTransitionStart msTransitionStart transitionstart",function(a){a.stopPropagation()});var homeParallaxList=$("#home-parallax"),chapter1ParallaxList=$("#chapter-1-parallax"),chapter2ParallaxList=$("#chapter-2-parallax"),chapter3ParallaxList=$("#chapter-3-parallax"),chapter4ParallaxList=$("#chapter-4-parallax"),chapter5ParallaxList=$("#chapter-5-parallax"),chapter6ParallaxList=$("#chapter-6-parallax"),homeParallaxObj,chapter1ParallaxObj,chapter2ParallaxObj,chapter3ParallaxObj,chapter4ParallaxObj,chapter5ParallaxObj,chapter6ParallaxObj,underlay=$("#underlay"),overlay=$("#overlay"),subNav=$("#sub-nav"),backgroundImage=$("#background-image"),homeVideo=$("#home-video"),backgroundVideo=$("#background-video"),title=$("#home #title"),horizontalLogo=$(".logo-container.horizontal"),onlyFadeUnderlay=!1,activeSection;body.one("start.np",function(){onePageScroll.onepage_scroll({sectionContainer:"section",easing:"ease",animationTime:isDev?100:1e3,keyboard:!0,direction:"vertical",pagination:!1,loop:!1,beforeMove:processBeforeMove,afterMove:processAfterMove}),enableParallax(homeParallaxList,"home-parallax"),showHomeFireworks()});var timelineEntryStart=$(".timeline-entry.start"),timelineEntryEnd=$(".timeline-entry.end"),timelineMarkOffset=30;$(window).load(calculateTimelineBorders),$(window).resize($.debounce(1e3,calculateTimelineBorders));var galleryTypeA=$(".gallery.type-a"),galleryPaddingTotal=matchMedia("only screen and (max-width: 1024px)").matches?240:80,containerWidth=galleryTypeA.closest(".container").width();galleryTypeA.each(function(){function a(){t.unbind().removeClass("active").removeAttr("style"),galleryPaddingTotal=matchMedia("only screen and (max-width: 1024px)").matches?240:80,containerWidth=galleryTypeA.closest(".container").width(),e.Cloud9Carousel({autoPlay:0,bringToFront:!0,smooth:!0,transforms:!0,speed:250,itemClass:"gallery-entry",yRadius:-25,xRadius:(containerWidth-galleryPaddingTotal)/(n-1)}),o.addClass("active"),t.click(function(){t.removeClass("active"),$(this).addClass("active")})}var e=$(this),t=$(".gallery-entry",e),o=t.first(),n=t.length;2===n&&e.addClass("has-two"),e.Cloud9Carousel({autoPlay:0,bringToFront:!0,smooth:!0,transforms:!0,speed:250,itemClass:"gallery-entry",yRadius:-25,xRadius:(containerWidth-galleryPaddingTotal)/(n-1)}),o.addClass("active"),t.click(function(){t.removeClass("active"),$(this).addClass("active")}),$(window).resize($.debounce(500,a))});var galleryTypeB=$(".gallery.type-b");galleryTypeB.each(function(){function a(){n=matchMedia("only screen and (max-width: 1024px)").matches?60:120,r=$(e).closest(".container").width(),l=matchMedia("only screen and (max-width: 1024px)").matches?240:80,s=r-(o-1)*(n+i)-i-l,$("> li.active",e).css("width",s+"px")}var e=this,t=$("> li",e),o=t.length,n=matchMedia("only screen and (max-width: 1024px)").matches?60:120,i=10,r=$(e).closest(".container").width(),l=matchMedia("only screen and (max-width: 1024px)").matches?240:80,s=r-(o-1)*(n+i)-i-l;t.click(function(){t.removeClass("active").css("width",""),$(this).addClass("active").css("width",s+"px")}),$(window).resize($.debounce(500,a)),t.first().click()});var gallery=$(".gallery");if(isMobile){var touchXPos=0,touchDown=!1;gallery.on("touchstart",function(a){a.preventDefault(),touchXPos=a.originalEvent.touches[0].screenX,touchDown=!0}),gallery.on("touchmove",function(a){touchDown===!0&&($(this).stop(!0,!0).animate({scrollLeft:parseInt($(this).scrollLeft()+1.5*(touchXPos-a.originalEvent.touches[0].screenX))},250),touchXPos=a.originalEvent.touches[0].screenX)}),gallery.on("touchend touchcancel",function(){touchDown=!1})}else{var cursorXPos=0,cursorDown=!1;gallery.on("mousedown",function(a){cursorXPos=a.offsetX,cursorDown=!0}),gallery.on("mousemove",function(a){cursorDown===!0&&$(this).scrollLeft(parseInt($(this).scrollLeft()+(cursorXPos-a.offsetX)))}),gallery.on("mouseup mouseout",function(){cursorDown=!1})}var slider=$(".slider"),sliderSection=$("section.has-slider");$(window).load(function(){$.when(slider.twentytwenty()).done(function(){setTimeout(function(){slider.each(function(){var a=this,e=$(a).data("before-text")||"Before",t=$(a).data("after-text")||"After",o=$(".twentytwenty-handle",a),n=$(".twentytwenty-before-label, .twentytwenty-after-label",a);n.remove(),o.append('<div class="twentytwenty-before-label">'+e+"</div>",'<div class="twentytwenty-after-label">'+t+"</div>")}),$(this).trigger("resize")},1e3)})});var quoteImageContainer=$(".quote-image-container");$(window).resize($.debounce(500,centerQuoteImages)),$(window).load(centerQuoteImages)});