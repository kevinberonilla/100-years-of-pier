var page=$("html, body"),body=$("body"),isInternetExplorer=!1,isMobile=!1,isTabletOrLarger=!1,isDev=!1,mobileUserAgentString=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i,tabletUserAgentString=/(tablet|ipad|playbook|silk)|(android(?!.*mobile))/i;mobileUserAgentString.test(navigator.userAgent)&&(isMobile=!0,$(document).on("touchmove",function(a){a.preventDefault()})),(tabletUserAgentString.test(navigator.userAgent)||matchMedia("only screen and (min-width: 481px) and (min-height: 481px)").matches)&&(isTabletOrLarger=!0),(navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(isInternetExplorer=!0),$(document).ready(function(){function adjustVolume(a,e,t){$(a).stop().animate({volume:e},1e3,"linear",t)}function swapMusic(a){a[0].paused&&(music.each(function(){var a=$(this);adjustVolume(a,0,function(){a[0].pause()})}),a[0].volume=0,a[0].play(),adjustVolume(a,masterVolume))}function playChapterMusic(a){if(a.hasClass("end")){var e=a.prevAll(".has-intro").first().index("section"),t=$("#music-for-"+e);swapMusic(t)}else if(a.hasClass("has-intro")){var l=a.index("section"),n=$("#music-for-"+l);swapMusic(n)}else a.is("#home")&&swapMusic($("#music-for-0"))}function muteChapterMusic(a){var e=a.prevAll(".has-intro").first().index("section"),t=$("#music-for-"+e);adjustVolume(t[0],0),onePageScroll.one("before-move.np",function(){adjustVolume(t[0],masterVolume)})}function playSound(a){var e=a.index("section"),t=$("#sound-for-"+e),l=sound.not(t);adjustVolume(sound,0,function(){l[0].pause(),isNaN(l[0].duration)||(l[0].currentTime=0)}),t.length>0?(t[0].play(),adjustVolume(t,masterVolume)):sound.each(function(){var a=$(this);adjustVolume(a[0],0,function(){a[0].pause(),isNaN(l[0].duration)||(a[0].currentTime=0)})})}function calculateFullParentHeight(){var a=window.innerHeight;fullParentHeight.css("height",a+"px")}function substituteVideoElements(a){var e=a.attr("id"),t=a.attr("style").replace("background-image:","").replace(" ","").replace(";","");a.replaceWith('<div id="'+e+'"class="video-substitute"></div>'),$("#"+e).css("background-image",t)}function setCenter(){videoBackground.each(function(){var a=page.width(),e=page.height(),t=$(this).width(),l=$(this).height(),n=a/2-t/2+"px",r=e/2-l/2+"px";$(this).css({left:n,top:r})})}function playVideo(){videoBackground.each(function(){$(this)[0].play()})}function processLoadedMedia(){if(!body.hasClass("loaded")){var a=parseInt(loaded/total*100);loaded++,100>=a&&(loadingBar.css("width",a+"%"),loadingPercentage.text(a)),loaded>=total&&(body.trigger("load.np"),loadingBar.css("width","100%"),loadingPercentage.text("100"))}}function resizeQuoteBackgroundImages(){var a=window.innerWidth;quoteBackgroundImage.each(function(){var e=$(this),t=e.closest(".container").width(),l=a-t;e.css({left:"-"+l/2+"px",right:"-"+l/2+"px"})})}function calculateNavEntryHeight(){var a=window.innerWidth,e=window.innerHeight,t=matchMedia("only screen and (max-width: 480px)").matches?e-a/linkCount-5:e,l=t/linkCount;navEntry.css("height",l+"px")}function openNav(){body.addClass("nav-open disable-scroll disabled-onepage-scroll"),navEntry.each(function(){var a=this,e=$(a).index();setTimeout(function(){$(a).addClass("show")},75*(e+1))}),setTimeout(function(){blurElements.addClass("blur")},250)}function closeNav(){body.removeClass("nav-open disable-scroll disabled-onepage-scroll"),navEntry.removeClass("show"),setTimeout(function(){blurElements.removeClass("blur")},150)}function findIndex(a,e){for(var t,l=0;l<e.length;l++){var n=e.eq(l);if(a.is(n)){t=l;break}}return t}function setSubNavPosition(a){var e,t,l,n=$(a).hasClass("has-intro"),r=$('section[id*="chapter"]'),i=$("#home");if(subNavEntry.removeClass("active"),n)e=findIndex(a,r),t=$('[href="#'+r.eq(e).attr("id")+'"]',subNavEntry).parent(),l=e/r.length*100+"%";else if(a.is(i))l=0;else{e=findIndex(a,section);var o=section.eq(e).prevAll(".has-intro").first(),s=(o.attr("id"),findIndex(o,section)),c=findIndex(o,r),d=c/r.length*100,e=findIndex(a,section),u=(e-s)/chapterSectionArray[c]/r.length*100;t=$('[href="#'+section.eq(s).attr("id")+'"]',subNavEntry).parent(),l=d+u+"%"}positionIndicator.css({width:"",height:""}),matchMedia("only screen and (max-width: 480px)").matches?positionIndicator.css("width",l):positionIndicator.css("height",l),t&&t.addClass("active")}function processAnimateIn(a){var e=$(".animate-in",a),t=$(".scroll-message",a);e.each(function(){function a(){0==t||e.is("[data-delay]")||e.attr("data-delay",t+"00")}var e=$(this),t=e.index();$.when(a()).done(function(){var a=e.data("delay")||0;setTimeout(function(){e.addClass("reveal")},a)})}),t.addClass("show")}function enableParallax(a,e){switch(e){case"home-parallax":"undefined"==typeof homeParallaxObj?homeParallaxObj=a.parallax(parallaxArgs):homeParallaxObj.parallax("enable");break;case"chapter-1-parallax":"undefined"==typeof chapter1ParallaxObj?chapter1ParallaxObj=a.parallax(parallaxArgs):chapter1ParallaxObj.parallax("enable");break;case"chapter-2-parallax":"undefined"==typeof chapter2ParallaxObj?chapter2ParallaxObj=a.parallax(parallaxArgs):chapter2ParallaxObj.parallax("enable");break;case"chapter-3-parallax":"undefined"==typeof chapter3ParallaxObj?chapter3ParallaxObj=a.parallax(parallaxArgs):chapter3ParallaxObj.parallax("enable");break;case"chapter-4-parallax":"undefined"==typeof chapter4ParallaxObj?chapter4ParallaxObj=a.parallax(parallaxArgs):chapter4ParallaxObj.parallax("enable");break;case"chapter-5-parallax":"undefined"==typeof chapter5ParallaxObj?chapter5ParallaxObj=a.parallax(parallaxArgs):chapter5ParallaxObj.parallax("enable");break;case"chapter-6-parallax":"undefined"==typeof chapter6ParallaxObj?chapter6ParallaxObj=a.parallax(parallaxArgs):chapter6ParallaxObj.parallax("enable");break;case"end-parallax":"undefined"==typeof endParallaxObj?endParallaxObj=a.parallax(parallaxArgs):endParallaxObj.parallax("enable")}}function disableParallax(a){if("undefined"==typeof a)"undefined"!=typeof homeParallaxObj&&homeParallaxObj.parallax("disable"),"undefined"!=typeof chapter1ParallaxObj&&chapter1ParallaxObj.parallax("disable"),"undefined"!=typeof chapter2ParallaxObj&&chapter2ParallaxObj.parallax("disable"),"undefined"!=typeof chapter3ParallaxObj&&chapter3ParallaxObj.parallax("disable"),"undefined"!=typeof chapter4ParallaxObj&&chapter4ParallaxObj.parallax("disable"),"undefined"!=typeof chapter5ParallaxObj&&chapter5ParallaxObj.parallax("disable"),"undefined"!=typeof chapter6ParallaxObj&&chapter6ParallaxObj.parallax("disable"),"undefined"!=typeof endParallaxObj&&endParallaxObj.parallax("disable");else switch(a){case"home-parallax":"undefined"!=typeof homeParallaxObj&&homeParallaxObj.parallax("disable");break;case"chapter-1-parallax":"undefined"!=typeof chapter1ParallaxObj&&chapter1ParallaxObj.parallax("disable");break;case"chapter-2-parallax":"undefined"!=typeof chapter2ParallaxObj&&chapter2ParallaxObj.parallax("disable");break;case"chapter-3-parallax":"undefined"!=typeof chapter3ParallaxObj&&chapter3ParallaxObj.parallax("disable");break;case"chapter-4-parallax":"undefined"!=typeof chapter4ParallaxObj&&chapter4ParallaxObj.parallax("disable");break;case"chapter-5-parallax":"undefined"!=typeof chapter5ParallaxObj&&chapter5ParallaxObj.parallax("disable");break;case"chapter-6-parallax":"undefined"!=typeof chapter6ParallaxObj&&chapter6ParallaxObj.parallax("disable");break;case"end-parallax":"undefined"!=typeof endParallaxObj&&endParallaxObj.parallax("disable")}}function revealHomeFireworks(){var a=$("> li",homeParallaxList);homeParallaxList.addClass("show"),a.each(function(){var a=$("img",this),e=$(this).index();setTimeout(function(){a.addClass("show")},100*e)})}function processBeforeMove(){if(activeSection=$("section.active"),onePageScroll.trigger("before-move.np"),activeSection.is("#home")?(homeVideo.addClass("show"),horizontalLogo.removeClass("show"),subNav.removeClass("show")):(homeVideo.removeClass("show"),subNav.addClass("show"),horizontalLogo.addClass("show")),activeSection.hasClass("has-overlay")?overlay.addClass("show"):overlay.removeClass("show"),activeSection.hasClass("has-underlay")){var underlayUrl=activeSection.data("underlay-background");onlyFadeUnderlay?(underlay.addClass("only-fade"),onlyFadeUnderlay=!1):underlay.removeClass("only-fade"),underlay.css("background-image","url("+underlayUrl+")").addClass("show")}else underlay.removeClass("show");if(activeSection.hasClass("has-parallax")){var parallaxList=$(eval(activeSection.data("parallax-list"))),parallaxId=activeSection.data("parallax-id");allParallaxLists.removeClass("show"),disableParallax(),parallaxList.addClass("show"),enableParallax(eval(parallaxList),parallaxId)}else allParallaxLists.removeClass("show"),disableParallax();if(activeSection.hasClass("has-background-underlay")){var backgroundImageUrl=activeSection.data("background-image");backgroundImage.css("background-image","url("+backgroundImageUrl+")").addClass("show")}else backgroundImage.removeClass("show");activeSection.is("#home")||activeSection.hasClass("has-overlay")||activeSection.hasClass("has-underlay")?backgroundVideo.removeClass("show"):backgroundVideo.addClass("show"),activeSection.hasClass("end")&&(onlyFadeUnderlay=!0),isTabletOrLarger&&(activeSection.hasClass("no-music")&&muteChapterMusic(activeSection),playChapterMusic(activeSection),playSound(activeSection)),setSubNavPosition(activeSection)}function processAfterMove(){onePageScroll.trigger("after-move.np"),processAnimateIn(activeSection)}function calculateTimelineBorders(){setTimeout(function(){var a;if(matchMedia("only screen and (max-width: 480px)").matches){var e=window.innerWidth;a=e/linkCount-20}else a=20;timelineEntryStart.each(function(){var e=$(this).find(".timeline-content").offset().top,t=$(this).closest("section").offset().top,l=e-t+timelineMarkOffset+a,n=$(".timeline-border",this);n.css("top",l+"px")}),timelineEntryEnd.each(function(){var a,e=$(this),t=e.find(".timeline-content").innerHeight(),l=e.closest("section").height()>window.innerHeight?e.closest("section").height():window.innerHeight,n=$(".timeline-border",e);if(e.hasClass("end-lower")&&matchMedia("only screen and (min-width: 769px)").matches){var r=e.find(".end-anchor").height();a=(l-t)/2+r/2}else{var i=e.find(".timeline-body").last().height(),o=e.find(".timeline-gallery").outerHeight(!0),s=e.find(".timeline-slider").outerHeight(!0);a=(l-t)/2+i+o+s-timelineMarkOffset}n.css("bottom",a+"px")})},1e3)}function centerQuoteImages(){quoteImageContainer.each(function(){var a=$(this),e=$(".quote-image",a),t=a.width(),l=a.height(),n=e.width(),r=e.height(),i=t-n,o=l-r,s=e.data("offset-x")||0,c=e.data("offset-y")||0;e.css({left:i/2+s+"px",top:o/2+c+"px"})})}var onePageScroll=$("#main"),audioIcon=$("#audio-icon"),audio=$("audio"),music=$('audio[id*="music-for"]'),sound=$('audio[id*="sound-for"]'),masterVolume=1;isTabletOrLarger?audioIcon.click(function(){$(this).hasClass("fa-volume-up")?($(this).removeClass("fa-volume-up").addClass("fa-volume-off adjust-p-r-6"),masterVolume=0):($(this).removeClass("fa-volume-off adjust-p-r-6").addClass("fa-volume-up"),masterVolume=1),audio.each(function(){var a=$(this);a.stop(!1,!0),a.is(sound)&&1===masterVolume?a[0].volume=0:(a.is(sound)&&0===masterVolume&&(a[0].pause(),a[0].currentTime=0),a[0].volume=masterVolume)})}).parent().addClass("show"):(audioIcon.unbind(),$("#preload audio").remove());var fullParentHeight=$(".full-parent-height");calculateFullParentHeight(),$(window).resize(calculateFullParentHeight);var videoBackground=$(".video-background"),scrollPos,adjustedPos,videoOffset;isMobile?videoBackground.each(function(){substituteVideoElements($(this))}):videoBackground.each(function(){var a=$(this),e=a.data("src"),t="undefined"!=typeof a.data("formats")?a.data("formats").replace(" ","").split(","):"";if(e&&t.length>0)for(var l=0;l<t.length;l++)a.append('<source src="'+e+"."+t[l]+'">');else substituteVideoElements(a)}),$(window).resize(setCenter),$(window).load(setCenter),!isMobile&&videoBackground.length>0&&$(window).load(playVideo);var image=$("#preload img"),audioVideo=$('#preload audio[id*="music-for"], .video-background[data-src][data-formats]'),total=isMobile?image.length:image.length+audioVideo.length,loadingBar=$("#loading-bar"),loaded=0,loadingPercentage=$("#loading-percentage .number");page.one("load.np",function(){var a=$("#home-video"),e=$("#music-for-0"),t=$("#home .scroll-message");setTimeout(function(){body.addClass("loaded"),a.addClass("show"),isTabletOrLarger&&e[0].play()},250),setTimeout(function(){body.trigger("start.np")},isDev?0:1e3),setTimeout(function(){t.addClass("show")},2500)}),isDev&&setTimeout(function(){body.trigger("load.np")},500),image.each(function(){this.complete?processLoadedMedia():$(this).load(processLoadedMedia)}),audioVideo.each(function(){var a=$(this)[0],e=setTimeout(processLoadedMedia,5e3);a.readyState>3?(clearTimeout(e),processLoadedMedia()):a.addEventListener("canplay",processLoadedMedia)});var quoteBackgroundImage=$(".quote-background-image");resizeQuoteBackgroundImages(),$(window).resize($.debounce(500,resizeQuoteBackgroundImages));var navEntry=$("nav > ul > li"),navLink=$("a",navEntry),linkCount=navEntry.length,openNavButton=$("#open-nav-button"),closeNavButton=$("#close-nav-button"),blurElements=$("#underlay, .video-background, .video-substitute, .parallax"),main=$(".main");navLink.click(function(a){a.preventDefault();var e=$(this).attr("href"),t=$(e).index()+1;closeNav(),main.moveTo(t)}),calculateNavEntryHeight(),$(window).resize($.debounce(750,calculateNavEntryHeight)),isTabletOrLarger&&(openNavButton.click(openNav),closeNavButton.click(closeNav));for(var subNavEntry=$("#sub-nav > ul > li"),subNavLink=$("a",subNavEntry),positionIndicator=$("#position-indicator"),section=$("section:not(#home)"),chapterSectionArray=[],sectionCount=1,i=0;i<section.length;i++){var currentSection=section.eq(i);currentSection.hasClass("end")?(chapterSectionArray.push(sectionCount),sectionCount=1):sectionCount++}subNavLink.click(function(a){a.preventDefault();var e=$(this).attr("href"),t=$(e).index()+1;main.moveTo(t)}),$(window).resize($.debounce(750,function(){setSubNavPosition($("section.active"))}));var homeLink=$(".logo-container.horizontal > a");homeLink.click(function(){main.moveTo(1)});var sectionElements=$("#main section *");sectionElements.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend webkitTransitionStart otransitionstart oTransitionStart msTransitionStart transitionstart",function(a){a.stopPropagation()});var parallaxArgs={clipRelativeInput:!0,limitX:150,limitY:100},homeParallaxList=$("#home-parallax"),chapter1ParallaxList=$("#chapter-1-parallax"),chapter2ParallaxList=$("#chapter-2-parallax"),chapter3ParallaxList=$("#chapter-3-parallax"),chapter4ParallaxList=$("#chapter-4-parallax"),chapter5ParallaxList=$("#chapter-5-parallax"),chapter6ParallaxList=$("#chapter-6-parallax"),endParallaxList=$("#end-parallax"),allParallaxLists=$("#home-parallax, #chapter-1-parallax, #chapter-2-parallax, #chapter-3-parallax, #chapter-4-parallax, #chapter-5-parallax, #chapter-6-parallax, #end-parallax"),homeParallaxObj,chapter1ParallaxObj,chapter2ParallaxObj,chapter3ParallaxObj,chapter4ParallaxObj,chapter5ParallaxObj,chapter6ParallaxObj,endParallaxObj,underlay=$("#underlay"),overlay=$("#overlay"),subNav=$("#sub-nav"),backgroundImage=$("#background-image"),homeVideo=$("#home-video"),backgroundVideo=$("#background-video"),title=$("#home #title"),horizontalLogo=$(".logo-container.horizontal"),onlyFadeUnderlay=!1,activeSection;body.one("start.np",function(){onePageScroll.onepage_scroll({sectionContainer:"section",easing:"ease",animationTime:isDev?100:1e3,keyboard:!0,direction:"vertical",pagination:!1,loop:!1,beforeMove:processBeforeMove,afterMove:processAfterMove}),enableParallax(homeParallaxList,"home-parallax"),revealHomeFireworks()});var timelineEntryStart=$(".timeline-entry.start"),timelineEntryEnd=$(".timeline-entry.end"),timelineMarkOffset=30;$(window).load(calculateTimelineBorders),$(window).resize($.debounce(1e3,calculateTimelineBorders));var galleryTypeA=$(".gallery.type-a"),galleryPaddingTotal=matchMedia("only screen and (max-width: 1024px)").matches?240:80,containerWidth=galleryTypeA.closest(".container").width();galleryTypeA.each(function(){function a(){t.unbind().removeClass("active").removeAttr("style"),galleryPaddingTotal=matchMedia("only screen and (max-width: 1024px)").matches?240:80,containerWidth=galleryTypeA.closest(".container").width(),e.Cloud9Carousel({autoPlay:0,bringToFront:!0,smooth:!0,transforms:!0,speed:250,itemClass:"gallery-entry",yRadius:-25,xRadius:(containerWidth-galleryPaddingTotal)/(n-1)}),l.addClass("active"),t.click(function(){t.removeClass("active"),$(this).addClass("active")})}var e=$(this),t=$(".gallery-entry",e),l=t.first(),n=t.length;2===n&&e.addClass("has-two"),e.Cloud9Carousel({autoPlay:0,bringToFront:!0,smooth:!0,transforms:!0,speed:250,itemClass:"gallery-entry",yRadius:-25,xRadius:(containerWidth-galleryPaddingTotal)/(n-1)}),l.addClass("active"),t.click(function(){t.removeClass("active"),$(this).addClass("active")}),$(window).resize($.debounce(500,a))});var galleryTypeB=$(".gallery.type-b");galleryTypeB.each(function(){function a(){n=matchMedia("only screen and (max-width: 1024px)").matches?60:120,i=$(e).closest(".container").width(),o=matchMedia("only screen and (max-width: 1024px)").matches?240:80,s=i-(l-1)*(n+r)-r-o,$("> li.active",e).css("width",s+"px")}var e=this,t=$("> li",e),l=t.length,n=matchMedia("only screen and (max-width: 1024px)").matches?60:120,r=10,i=$(e).closest(".container").width(),o=matchMedia("only screen and (max-width: 1024px)").matches?240:80,s=i-(l-1)*(n+r)-r-o;t.click(function(){t.removeClass("active").css("width",""),$(this).addClass("active").css("width",s+"px")}),$(window).resize($.debounce(500,a)),t.first().click()});var gallery=$(".gallery");if(isMobile){var touchXPos=0,touchDown=!1;gallery.on("touchstart",function(a){matchMedia("only screen and (max-width: 768px)").matches&&(a.preventDefault(),touchXPos=a.originalEvent.touches[0].screenX,touchDown=!0)}),gallery.on("touchmove",function(a){matchMedia("only screen and (max-width: 768px)").matches&&touchDown===!0&&($(this).stop(!0,!0).animate({scrollLeft:parseInt($(this).scrollLeft()+1.5*(touchXPos-a.originalEvent.touches[0].screenX))},250),touchXPos=a.originalEvent.touches[0].screenX)}),gallery.on("touchend touchcancel",function(){touchDown=!1})}else{var cursorXPos=0,cursorDown=!1;gallery.on("mousedown",function(a){cursorXPos=a.offsetX,cursorDown=!0}),gallery.on("mousemove",function(a){cursorDown===!0&&$(this).scrollLeft(parseInt($(this).scrollLeft()+(cursorXPos-a.offsetX)))}),gallery.on("mouseup mouseout",function(){cursorDown=!1})}var slider=$(".slider"),sliderSection=$("section.has-slider");$(window).load(function(){$.when(slider.twentytwenty()).done(function(){setTimeout(function(){slider.each(function(){var a=this,e=$(a).data("before-text")||"Before",t=$(a).data("after-text")||"After",l=$(".twentytwenty-handle",a),n=$(".twentytwenty-before-label, .twentytwenty-after-label",a);n.remove(),l.append('<div class="twentytwenty-before-label">'+e+"</div>",'<div class="twentytwenty-after-label">'+t+"</div>")}),$(this).trigger("resize")},1e3)})});var quoteImageContainer=$(".quote-image-container");$(window).resize($.debounce(500,centerQuoteImages)),$(window).load(centerQuoteImages)});